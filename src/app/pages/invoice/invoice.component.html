<mat-card class="cardWithShadow">
    <mat-card-content>
      <mat-card-title>Invoice Records</mat-card-title>
      <a>&#8203;&#8203;&#8203;&#8203;&#8203;</a>
      <!-- Filter Section -->
      <div class="filter-container">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Filter by Status</mat-label>
          <mat-select [(ngModel)]="filterStatus" (selectionChange)="applyFilters()">
            <mat-option value="">All</mat-option>
            <mat-option value="Paid">Paid</mat-option>
            <mat-option value="Pending">Pending</mat-option>
            <mat-option value="Unpaid">Unpaid</mat-option>
          </mat-select>
        </mat-form-field>
  
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Search</mat-label>
          <input matInput [(ngModel)]="searchTerm" (input)="applyFilters()" placeholder="Search by Supplier or Vehicle">
        </mat-form-field>
      </div>
  
      <!-- Add/Edit Form -->
      <div *ngIf="showAddForm" class="form-container">
        <mat-card class="form-card">
          <mat-card-title>
            {{ isEditing ? 'Edit Invoice' : 'Add Invoice' }}
          </mat-card-title>
          <mat-card-content>
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Issue Date</mat-label>
              <input matInput [matDatepicker]="issuePicker" [(ngModel)]="invoiceIssueDate" required>
              <mat-datepicker-toggle matSuffix [for]="issuePicker"></mat-datepicker-toggle>
              <mat-datepicker #issuePicker></mat-datepicker>
            </mat-form-field>
  
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Due Date</mat-label>
              <input matInput [matDatepicker]="duePicker" [(ngModel)]="invoiceDueDate" required>
              <mat-datepicker-toggle matSuffix [for]="duePicker"></mat-datepicker-toggle>
              <mat-datepicker #duePicker></mat-datepicker>
            </mat-form-field>
  
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Amount</mat-label>
              <input matInput type="number" [(ngModel)]="invoiceAmount" required>
            </mat-form-field>
  
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Status</mat-label>
              <mat-select [(ngModel)]="invoiceStatus" required>
                <mat-option value="Paid">Paid</mat-option>
                <mat-option value="Pending">Pending</mat-option>
                <mat-option value="Unpaid">Unpaid</mat-option>
              </mat-select>
            </mat-form-field>
  
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Supplier</mat-label>
              <mat-select [(ngModel)]="invoiceSupplierID" required>
                <mat-option *ngFor="let supplier of suppliers" [value]="supplier.id">
                  {{ supplier.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
  
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Vehicle</mat-label>
              <mat-select [(ngModel)]="invoiceVehicleID" required>
                <mat-option *ngFor="let car of cars" [value]="car.id">
                  {{ car.model }} ({{ car.licensePlate }})
                </mat-option>
              </mat-select>
            </mat-form-field>
  
            <div class="form-actions">
              <button mat-raised-button color="primary" (click)="isEditing ? saveEditedInvoice() : addInvoice()">
                {{ isEditing ? 'Save Changes' : 'Add Invoice' }}
              </button>
              <button mat-stroked-button color="warn" (click)="cancelEdit()">Cancel</button>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
  
      <!-- Invoice Table -->
      <div *ngIf="!showAddForm" class="table-responsive">
        <div class="action-buttons">
          <button mat-raised-button color="primary" class="add-btn" (click)="toggleAddForm()">Add Invoice</button>
        </div>
        <table mat-table [dataSource]="filteredDataSource" class="w-100">
  
          <!-- Issue Date Column -->
          <ng-container matColumnDef="issueDate">
            <th mat-header-cell *matHeaderCellDef>Issue Date</th>
            <td mat-cell *matCellDef="let invoice">
              {{ invoice.issueDate | date:'yyyy-MM-dd' }}
            </td>
          </ng-container>
  
          <!-- Due Date Column -->
          <ng-container matColumnDef="dueDate">
            <th mat-header-cell *matHeaderCellDef>Due Date</th>
            <td mat-cell *matCellDef="let invoice">
              {{ invoice.dueDate | date:'yyyy-MM-dd' }}
            </td>
          </ng-container>
  
          <!-- Amount Column -->
          <ng-container matColumnDef="amount">
            <th mat-header-cell *matHeaderCellDef>Amount</th>
            <td mat-cell *matCellDef="let invoice">
              {{ invoice.amount | currency }}
            </td>
          </ng-container>
  
          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let invoice">
              {{ invoice.status }}
            </td>
          </ng-container>
  
          <!-- Supplier Column -->
          <ng-container matColumnDef="supplier">
            <th mat-header-cell *matHeaderCellDef>Supplier</th>
            <td mat-cell *matCellDef="let invoice">
              <span class="clickable" (click)="openSupplierDetails(invoice.supplierID)">
                {{ getSupplierName(invoice.supplierID) }}
              </span>
            </td>
          </ng-container>
  
          <!-- Vehicle Column -->
          <ng-container matColumnDef="vehicle">
            <th mat-header-cell *matHeaderCellDef>Vehicle</th>
            <td mat-cell *matCellDef="let invoice">
              <span class="clickable" (click)="openCarDetails(invoice.vehicleID)">
                {{ getVehicleModel(invoice.vehicleID) }}
              </span>
            </td>
          </ng-container>
  
          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let invoice">
              <button mat-icon-button [matMenuTriggerFor]="menu">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="startEdit(invoice)">
                  <mat-icon>edit</mat-icon>
                  <span>Edit</span>
                </button>
                <button mat-menu-item (click)="deleteInvoice(invoice.id)">
                  <mat-icon>delete</mat-icon>
                  <span>Delete</span>
                </button>
                <button mat-menu-item (click)="printInvoice(invoice)">
                  <mat-icon>print</mat-icon>
                  <span>Print</span>
                </button>
              </mat-menu>
            </td>
          </ng-container>
  
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </div>
    </mat-card-content>
  </mat-card>
  